<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Autonomous Incident Commander - Enterprise Demo</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-blue: #00d4ff;
        --primary-green: #00ff88;
        --primary-red: #ff6b6b;
        --primary-yellow: #f9ca24;
        --primary-purple: #6c5ce7;
        --bg-dark: #0a0e13;
        --bg-card: rgba(255, 255, 255, 0.03);
        --bg-card-hover: rgba(255, 255, 255, 0.08);
        --border-color: rgba(255, 255, 255, 0.1);
        --text-primary: #ffffff;
        --text-secondary: #b8c5d1;
        --text-muted: #8892a0;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", sans-serif;
        background: linear-gradient(
          135deg,
          var(--bg-dark) 0%,
          #1a1f2e 50%,
          #0f1419 100%
        );
        color: var(--text-primary);
        overflow-x: hidden;
        min-height: 100vh;
      }

      /* Enhanced Header */
      .dashboard-header {
        background: rgba(10, 14, 19, 0.95);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid var(--border-color);
        padding: 1.25rem 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        z-index: 1000;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .logo i {
        font-size: 2.5rem;
        color: var(--primary-blue);
        animation: logoGlow 3s ease-in-out infinite alternate;
      }

      @keyframes logoGlow {
        0% {
          filter: drop-shadow(0 0 5px var(--primary-blue));
        }
        100% {
          filter: drop-shadow(0 0 15px var(--primary-blue));
        }
      }

      .logo h1 {
        font-size: 1.75rem;
        font-weight: 800;
        background: linear-gradient(
          135deg,
          var(--primary-blue),
          #0099cc,
          var(--primary-green)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .logo .subtitle {
        font-size: 0.9rem;
        color: var(--text-muted);
        margin-left: 1rem;
        font-weight: 500;
      }

      /* Enhanced Connection Status */
      .connection-status {
        display: flex;
        align-items: center;
        gap: 1.5rem;
      }

      .status-indicator {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 1.5rem;
        background: rgba(0, 212, 255, 0.1);
        border: 1px solid rgba(0, 212, 255, 0.3);
        border-radius: 25px;
        transition: all 0.3s ease;
      }

      .status-indicator:hover {
        background: rgba(0, 212, 255, 0.15);
        transform: translateY(-1px);
      }

      .status-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: var(--primary-green);
        animation: statusPulse 2s ease-in-out infinite;
        box-shadow: 0 0 10px var(--primary-green);
      }

      .status-dot.disconnected {
        background: var(--primary-red);
        box-shadow: 0 0 10px var(--primary-red);
      }

      @keyframes statusPulse {
        0%,
        100% {
          opacity: 1;
          transform: scale(1);
        }
        50% {
          opacity: 0.7;
          transform: scale(1.2);
        }
      }

      /* Performance Indicator */
      .performance-indicator {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: rgba(0, 255, 136, 0.1);
        border: 1px solid rgba(0, 255, 136, 0.3);
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
      }

      /* Enhanced Grid Layout */
      .main-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        grid-template-rows: auto auto auto;
        gap: 2rem;
        padding: 2rem;
        min-height: calc(100vh - 100px);
      }

      /* Enhanced Cards with Glassmorphism */
      .card {
        background: var(--bg-card);
        backdrop-filter: blur(20px); /* Glassmorphism effect */
        border: 1px solid var(--border-color);
        border-radius: 20px;
        padding: 2rem;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
      }

      .card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(
          90deg,
          var(--primary-blue),
          var(--primary-green)
        );
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .card:hover {
        transform: translateY(-4px);
        border-color: rgba(0, 212, 255, 0.4);
        background: var(--bg-card-hover);
        box-shadow: 0 20px 40px rgba(0, 212, 255, 0.1);
      }

      .card:hover::before {
        opacity: 1;
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
      }

      .card-title {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .card-icon {
        font-size: 1.4rem;
        color: var(--primary-blue);
        animation: iconFloat 3s ease-in-out infinite;
      }

      @keyframes iconFloat {
        0%,
        100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-3px);
        }
      }

      /* Enhanced Agent Activity Feed */
      .agent-activity {
        grid-column: 1;
        grid-row: 1 / 3;
        max-height: 700px;
        overflow-y: auto;
      }

      .agent-activity::-webkit-scrollbar {
        width: 6px;
      }

      .agent-activity::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 3px;
      }

      .agent-activity::-webkit-scrollbar-thumb {
        background: var(--primary-blue);
        border-radius: 3px;
      }

      .activity-item {
        display: flex;
        align-items: flex-start;
        gap: 1.25rem;
        padding: 1.5rem;
        margin-bottom: 1rem;
        background: rgba(255, 255, 255, 0.02);
        border-radius: 16px;
        border-left: 4px solid;
        animation: slideInLeft 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .activity-item::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          135deg,
          transparent,
          rgba(255, 255, 255, 0.03)
        );
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .activity-item:hover::before {
        opacity: 1;
      }

      @keyframes slideInLeft {
        from {
          transform: translateX(-30px);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      /* Agent Type Colors */
      .activity-detection {
        border-left-color: #ff6b6b;
      }
      .activity-diagnosis {
        border-left-color: #4ecdc4;
      }
      .activity-prediction {
        border-left-color: #45b7d1;
      }
      .activity-resolution {
        border-left-color: #f9ca24;
      }
      .activity-communication {
        border-left-color: #6c5ce7;
      }

      .activity-icon {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.4rem;
        color: white;
        flex-shrink: 0;
        position: relative;
        overflow: hidden;
      }

      .activity-icon::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .activity-item:hover .activity-icon::before {
        opacity: 1;
      }

      .activity-detection .activity-icon {
        background: linear-gradient(135deg, #ff6b6b, #ee5a52);
        box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
      }
      .activity-diagnosis .activity-icon {
        background: linear-gradient(135deg, #4ecdc4, #44a08d);
        box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
      }
      .activity-prediction .activity-icon {
        background: linear-gradient(135deg, #45b7d1, #96c93d);
        box-shadow: 0 4px 15px rgba(69, 183, 209, 0.3);
      }
      .activity-resolution .activity-icon {
        background: linear-gradient(135deg, #f9ca24, #f0932b);
        box-shadow: 0 4px 15px rgba(249, 202, 36, 0.3);
      }
      .activity-communication .activity-icon {
        background: linear-gradient(135deg, #6c5ce7, #a29bfe);
        box-shadow: 0 4px 15px rgba(108, 92, 231, 0.3);
      }

      .activity-content {
        flex: 1;
      }

      .activity-title {
        font-weight: 700;
        margin-bottom: 0.5rem;
        font-size: 1.1rem;
      }

      .activity-description {
        color: var(--text-secondary);
        font-size: 0.95rem;
        margin-bottom: 0.75rem;
        line-height: 1.5;
      }

      .activity-details {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 12px;
        padding: 1rem;
        margin-top: 0.75rem;
        font-family: "SF Mono", "Monaco", "Cascadia Code", monospace;
        font-size: 0.85rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .activity-timestamp {
        font-size: 0.8rem;
        color: var(--text-muted);
        margin-top: 0.75rem;
        font-weight: 500;
      }

      /* Enhanced Confidence Bar */
      .confidence-bar {
        width: 100%;
        height: 6px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 3px;
        margin-top: 0.75rem;
        overflow: hidden;
        position: relative;
      }

      .confidence-fill {
        height: 100%;
        background: linear-gradient(90deg, #ff6b6b, #f9ca24, #00ff88);
        border-radius: 3px;
        transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
      }

      .confidence-fill::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        animation: shimmer 2s infinite;
      }

      @keyframes shimmer {
        0% {
          transform: translateX(-100%);
        }
        100% {
          transform: translateX(100%);
        }
      }

      /* Enhanced Control Panel */
      .control-panel {
        grid-column: 2;
        grid-row: 1;
      }

      .scenario-buttons {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1rem;
        margin-top: 1.5rem;
      }

      .scenario-btn {
        padding: 1.25rem;
        background: linear-gradient(135deg, #6c5ce7, #a29bfe);
        border: none;
        border-radius: 16px;
        color: white;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        align-items: center;
        gap: 1rem;
        text-align: left;
        position: relative;
        overflow: hidden;
      }

      .scenario-btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: left 0.6s ease;
      }

      .scenario-btn:hover::before {
        left: 100%;
      }

      .scenario-btn:hover {
        transform: translateY(-3px) scale(1.02);
        box-shadow: 0 15px 30px rgba(108, 92, 231, 0.4);
      }

      .scenario-btn:active {
        transform: translateY(-1px) scale(0.98);
      }

      .scenario-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .scenario-btn i {
        font-size: 1.4rem;
        z-index: 1;
      }

      .scenario-content {
        z-index: 1;
      }

      .scenario-title {
        font-size: 1rem;
        margin-bottom: 0.25rem;
      }

      .scenario-subtitle {
        font-size: 0.8rem;
        opacity: 0.9;
      }

      /* Enhanced Performance Metrics */
      .performance-metrics {
        grid-column: 2;
        grid-row: 2;
      }

      .metric-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
      }

      .metric-item:hover {
        background: rgba(255, 255, 255, 0.02);
        margin: 0 -1rem;
        padding: 1rem;
        border-radius: 8px;
      }

      .metric-item:last-child {
        border-bottom: none;
      }

      .metric-label {
        font-weight: 600;
        color: var(--text-secondary);
      }

      .metric-value {
        font-weight: 700;
        font-size: 1.1rem;
        color: var(--primary-green);
        text-shadow: 0 0 10px rgba(0, 255, 136, 0.3);
      }

      /* Enhanced Current Incident */
      .current-incident {
        grid-column: 1 / 3;
        grid-row: 3;
        border: 2px solid rgba(255, 107, 107, 0.3);
        background: linear-gradient(
          135deg,
          rgba(255, 107, 107, 0.05),
          rgba(255, 107, 107, 0.02)
        );
      }

      .incident-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        padding: 1.5rem;
        background: rgba(255, 107, 107, 0.1);
        border: 1px solid rgba(255, 107, 107, 0.3);
        border-radius: 16px;
        position: relative;
        overflow: hidden;
      }

      .incident-header::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 2px;
        background: linear-gradient(90deg, #ff6b6b, #f9ca24);
        animation: incidentPulse 2s ease-in-out infinite;
      }

      @keyframes incidentPulse {
        0%,
        100% {
          opacity: 0.5;
        }
        50% {
          opacity: 1;
        }
      }

      .incident-title {
        font-size: 1.4rem;
        font-weight: 700;
        color: var(--text-primary);
      }

      .incident-timer {
        font-size: 2rem;
        font-weight: 800;
        color: var(--primary-green);
        font-family: "SF Mono", "Monaco", "Cascadia Code", monospace;
        text-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
        animation: timerGlow 1s ease-in-out infinite alternate;
      }

      @keyframes timerGlow {
        0% {
          text-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
        }
        100% {
          text-shadow: 0 0 30px rgba(0, 255, 136, 0.8);
        }
      }

      .incident-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
        margin-top: 1.5rem;
      }

      .detail-card {
        background: rgba(255, 255, 255, 0.03);
        border-radius: 12px;
        padding: 1.5rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
      }

      .detail-card:hover {
        background: rgba(255, 255, 255, 0.05);
        transform: translateY(-2px);
      }

      .detail-title {
        font-weight: 700;
        margin-bottom: 1rem;
        color: var(--primary-blue);
        font-size: 1.1rem;
      }

      .detail-list {
        list-style: none;
      }

      .detail-list li {
        padding: 0.5rem 0;
        font-size: 0.95rem;
        color: var(--text-secondary);
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .detail-list li:before {
        content: "●";
        color: var(--primary-green);
        font-size: 0.8rem;
      }

      /* Status indicators */
      .status-pending {
        color: var(--primary-yellow);
      }
      .status-in-progress {
        color: var(--primary-blue);
      }
      .status-completed {
        color: var(--primary-green);
      }
      .status-failed {
        color: var(--primary-red);
      }

      /* Loading Animation */
      .loading-spinner {
        display: inline-block;
        width: 16px;
        height: 16px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: var(--primary-blue);
        animation: spin 1s ease-in-out infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Responsive Design */
      @media (max-width: 1400px) {
        .main-grid {
          grid-template-columns: 1fr;
          grid-template-rows: auto auto auto auto;
        }

        .agent-activity {
          grid-column: 1;
          grid-row: 1;
          max-height: 500px;
        }

        .control-panel {
          grid-column: 1;
          grid-row: 2;
        }

        .performance-metrics {
          grid-column: 1;
          grid-row: 3;
        }

        .current-incident {
          grid-column: 1;
          grid-row: 4;
        }
      }

      @media (max-width: 768px) {
        .dashboard-header {
          padding: 1rem;
          flex-direction: column;
          gap: 1rem;
        }

        .main-grid {
          padding: 1rem;
          gap: 1rem;
        }

        .card {
          padding: 1.5rem;
        }

        .incident-details {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <!-- Enhanced Dashboard Header -->
    <header class="dashboard-header">
      <div class="logo">
        <i class="fas fa-robot"></i>
        <div>
          <h1>Autonomous Incident Commander</h1>
          <span class="subtitle">Enterprise Real-time Demo</span>
        </div>
      </div>
      <div class="connection-status">
        <div class="performance-indicator">
          <i class="fas fa-tachometer-alt"></i>
          <span>95% MTTR Reduction</span>
        </div>
        <div class="status-indicator">
          <div class="status-dot" id="connection-dot"></div>
          <span id="connection-status">Connecting...</span>
        </div>
      </div>
    </header>
  </body>
</html>
    <!-- Enhanced Main Dashboard Grid -->
    <main class="main-grid">
      <!-- Enhanced Agent Activity Feed -->
      <section class="card agent-activity">
        <div class="card-header">
          <h2 class="card-title">
            <i class="fas fa-stream card-icon"></i>
            Live Agent Coordination
          </h2>
          <div class="loading-spinner" id="activity-spinner" style="display: none;"></div>
        </div>
        <div id="activity-feed">
          <div class="activity-item activity-detection">
            <div class="activity-icon">
              <i class="fas fa-search"></i>
            </div>
            <div class="activity-content">
              <div class="activity-title">System Ready</div>
              <div class="activity-description">
                Multi-agent system initialized and ready for autonomous incident response
              </div>
              <div class="activity-timestamp">System startup</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Enhanced Control Panel -->
      <section class="card control-panel">
        <div class="card-header">
          <h2 class="card-title">
            <i class="fas fa-gamepad card-icon"></i>
            Demo Scenarios
          </h2>
        </div>
        <div class="scenario-buttons">
          <button class="scenario-btn" data-scenario="database">
            <i class="fas fa-database"></i>
            <div class="scenario-content">
              <div class="scenario-title">Database Cascade</div>
              <div class="scenario-subtitle">Connection pool exhaustion</div>
            </div>
          </button>
          <button class="scenario-btn" data-scenario="ddos">
            <i class="fas fa-shield-alt"></i>
            <div class="scenario-content">
              <div class="scenario-title">DDoS Attack</div>
              <div class="scenario-subtitle">Traffic spike mitigation</div>
            </div>
          </button>
          <button class="scenario-btn" data-scenario="memory">
            <i class="fas fa-memory"></i>
            <div class="scenario-content">
              <div class="scenario-title">Memory Leak</div>
              <div class="scenario-subtitle">OOM error recovery</div>
            </div>
          </button>
          <button class="scenario-btn" data-scenario="api">
            <i class="fas fa-plug"></i>
            <div class="scenario-content">
              <div class="scenario-title">API Overload</div>
              <div class="scenario-subtitle">Rate limit activation</div>
            </div>
          </button>
          <button class="scenario-btn" data-scenario="storage">
            <i class="fas fa-hdd"></i>
            <div class="scenario-content">
              <div class="scenario-title">Storage Failure</div>
              <div class="scenario-subtitle">Failover and replication</div>
            </div>
          </button>
        </div>
      </section>

      <!-- Enhanced Performance Metrics -->
      <section class="card performance-metrics">
        <div class="card-header">
          <h2 class="card-title">
            <i class="fas fa-chart-line card-icon"></i>
            Live Metrics
          </h2>
        </div>
        <div class="metric-item">
          <span class="metric-label">Incidents Resolved</span>
          <span class="metric-value" id="incidents-resolved">2,847</span>
        </div>
        <div class="metric-item">
          <span class="metric-label">Cost Savings</span>
          <span class="metric-value" id="cost-savings">$1.24M</span>
        </div>
        <div class="metric-item">
          <span class="metric-label">Avg MTTR</span>
          <span class="metric-value" id="avg-mttr">167s</span>
        </div>
        <div class="metric-item">
          <span class="metric-label">Success Rate</span>
          <span class="metric-value" id="success-rate">92.5%</span>
        </div>
        <div class="metric-item">
          <span class="metric-label">Active Agents</span>
          <span class="metric-value" id="active-agents">5</span>
        </div>
      </section>

      <!-- Enhanced Current Incident -->
      <section class="card current-incident" id="current-incident" style="display: none;">
        <div class="card-header">
          <h2 class="card-title">
            <i class="fas fa-exclamation-triangle card-icon"></i>
            Active Incident Processing
          </h2>
        </div>
        <div class="incident-header">
          <div>
            <div class="incident-title" id="incident-title">No Active Incident</div>
            <div style="font-size: 0.95rem; color: var(--text-secondary); margin-top: 0.5rem;" id="incident-description"></div>
          </div>
          <div class="incident-timer" id="incident-timer">0:00</div>
        </div>
        <div class="incident-details">
          <div class="detail-card">
            <div class="detail-title">Affected Services</div>
            <ul class="detail-list" id="affected-services"></ul>
          </div>
          <div class="detail-card">
            <div class="detail-title">Key Metrics</div>
            <ul class="detail-list" id="key-metrics"></ul>
          </div>
          <div class="detail-card">
            <div class="detail-title">Agent Status</div>
            <ul class="detail-list" id="agent-status"></ul>
          </div>
        </div>
      </section>
    </main>

    <script>
      class EnhancedLiveDashboard {
        constructor() {
          this.ws = null;
          this.currentIncident = null;
          this.incidentStartTime = null;
          this.timerInterval = null;
          this.metrics = {
            incidents_resolved: 2847,
            total_cost_savings: 1240000,
            avg_mttr: 167,
            success_rate: 0.925,
            active_agents: 5
          };

          this.init();
        }

        init() {
          this.connectWebSocket();
          this.setupEventListeners();
          this.updateMetricsDisplay();
          this.startMetricsAnimation();
        }

        connectWebSocket() {
          const protocol = window.location.protocol === "https:" ? "wss:" : "ws:";
          const host = window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1" 
            ? "localhost:8000" 
            : window.location.host;
          const wsUrl = `${protocol}//${host}/ws`;

          console.log("🔌 Connecting to WebSocket:", wsUrl);

          this.ws = new WebSocket(wsUrl);

          this.ws.onopen = () => {
            console.log("✅ WebSocket connected");
            this.updateConnectionStatus(true);
          };

          this.ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            this.handleWebSocketMessage(data);
          };

          this.ws.onclose = () => {
            console.log("❌ WebSocket disconnected");
            this.updateConnectionStatus(false);
            setTimeout(() => this.connectWebSocket(), 3000);
          };

          this.ws.onerror = (error) => {
            console.error("🚨 WebSocket error:", error);
            this.updateConnectionStatus(false);
          };
        }

        updateConnectionStatus(connected) {
          const dot = document.getElementById("connection-dot");
          const status = document.getElementById("connection-status");

          if (connected) {
            dot.classList.remove("disconnected");
            status.textContent = "Real-time Connected";
          } else {
            dot.classList.add("disconnected");
            status.textContent = "Reconnecting...";
          }
        }

        handleWebSocketMessage(data) {
          console.log("📡 Received:", data);

          switch (data.type) {
            case "incident_started":
              this.handleIncidentStarted(data.data.incident);
              break;
            case "agent_action":
              this.handleAgentAction(data.data.action);
              break;
            case "incident_resolved":
              this.handleIncidentResolved(data.data.incident, data.data.metrics);
              break;
            case "connection_established":
              console.log("🎉 Connection established:", data.data.message);
              break;
          }
        }

        handleIncidentStarted(incident) {
          console.log("🚨 Incident started:", incident.title);

          this.currentIncident = incident;
          this.incidentStartTime = new Date(incident.created_at);

          // Show incident panel with animation
          const incidentPanel = document.getElementById("current-incident");
          incidentPanel.style.display = "block";
          incidentPanel.style.opacity = "0";
          incidentPanel.style.transform = "translateY(20px)";
          
          setTimeout(() => {
            incidentPanel.style.transition = "all 0.6s cubic-bezier(0.4, 0, 0.2, 1)";
            incidentPanel.style.opacity = "1";
            incidentPanel.style.transform = "translateY(0)";
          }, 100);

          // Update incident details
          document.getElementById("incident-title").textContent = incident.title;
          document.getElementById("incident-description").textContent = incident.description;

          // Update affected services
          const servicesList = document.getElementById("affected-services");
          servicesList.innerHTML = incident.affected_services
            .map((service) => `<li>${service}</li>`)
            .join("");

          // Update key metrics
          const metricsList = document.getElementById("key-metrics");
          metricsList.innerHTML = Object.entries(incident.metrics)
            .map(([key, value]) => `<li>${key.replace(/_/g, " ")}: ${value}${typeof value === "number" && value > 100 ? "" : "%"}</li>`)
            .join("");

          // Start timer
          this.startIncidentTimer();

          // Add to activity feed
          this.addActivityItem({
            agent_type: "detection",
            description: `🚨 Critical incident detected: ${incident.title}`,
            details: {
              severity: incident.severity,
              affected_services: incident.affected_services.length,
              cost_per_minute: `$${incident.metrics.cost_per_minute}/min`
            },
            timestamp: new Date().toISOString(),
            confidence: 1.0,
            status: "completed"
          });
        }

        handleAgentAction(action) {
          console.log("🤖 Agent action:", action.description);
          this.addActivityItem(action);
          this.updateAgentStatus(action.agent_type, action.status);
        }

        handleIncidentResolved(incident, metrics) {
          console.log("✅ Incident resolved:", incident.title);

          if (this.timerInterval) {
            clearInterval(this.timerInterval);
          }

          // Update metrics with animation
          this.metrics = metrics;
          this.updateMetricsDisplay();

          // Add resolution to activity feed
          this.addActivityItem({
            agent_type: "communication",
            description: `✅ Incident resolved successfully: ${incident.title}`,
            details: {
              resolution_time: `${incident.resolution_time}s`,
              actions_executed: incident.actions.length,
              success: true,
              cost_saved: "$15,000"
            },
            timestamp: new Date().toISOString(),
            confidence: 1.0,
            status: "completed"
          });

          // Celebrate resolution
          this.celebrateResolution();

          // Hide incident panel after celebration
          setTimeout(() => {
            const incidentPanel = document.getElementById("current-incident");
            incidentPanel.style.transition = "all 0.6s ease";
            incidentPanel.style.opacity = "0";
            incidentPanel.style.transform = "translateY(-20px)";
            
            setTimeout(() => {
              incidentPanel.style.display = "none";
              this.currentIncident = null;
            }, 600);
          }, 5000);
        }

        addActivityItem(action) {
          const feed = document.getElementById("activity-feed");

          const agentIcons = {
            detection: "fas fa-search",
            diagnosis: "fas fa-stethoscope", 
            prediction: "fas fa-crystal-ball",
            resolution: "fas fa-tools",
            communication: "fas fa-comments"
          };

          const statusClasses = {
            pending: "status-pending",
            in_progress: "status-in-progress", 
            completed: "status-completed",
            failed: "status-failed"
          };

          const item = document.createElement("div");
          item.className = `activity-item activity-${action.agent_type}`;

          const detailsHtml = action.details
            ? `<div class="activity-details">${JSON.stringify(action.details, null, 2)}</div>`
            : "";

          const confidenceHtml = action.confidence
            ? `<div class="confidence-bar">
                <div class="confidence-fill" style="width: ${action.confidence * 100}%"></div>
               </div>`
            : "";

          const statusHtml = action.status
            ? `<span class="${statusClasses[action.status]}">[${action.status.toUpperCase()}]</span>`
            : "";

          item.innerHTML = `
            <div class="activity-icon">
              <i class="${agentIcons[action.agent_type] || "fas fa-cog"}"></i>
            </div>
            <div class="activity-content">
              <div class="activity-title">
                ${action.agent_type.charAt(0).toUpperCase() + action.agent_type.slice(1)} Agent
                ${statusHtml}
              </div>
              <div class="activity-description">${action.description}</div>
              ${detailsHtml}
              ${confidenceHtml}
              <div class="activity-timestamp">${new Date(action.timestamp).toLocaleTimeString()}</div>
            </div>
          `;

          // Add to top of feed with animation
          feed.insertBefore(item, feed.firstChild);

          // Animate in
          item.style.opacity = "0";
          item.style.transform = "translateX(-30px)";
          setTimeout(() => {
            item.style.transition = "all 0.6s cubic-bezier(0.4, 0, 0.2, 1)";
            item.style.opacity = "1";
            item.style.transform = "translateX(0)";
          }, 100);

          // Remove old items (keep last 15)
          while (feed.children.length > 15) {
            const lastChild = feed.lastChild;
            lastChild.style.transition = "all 0.3s ease";
            lastChild.style.opacity = "0";
            lastChild.style.transform = "translateX(30px)";
            setTimeout(() => feed.removeChild(lastChild), 300);
          }
        }

        updateAgentStatus(agentType, status) {
          const statusList = document.getElementById("agent-status");
          if (!statusList) return;

          let statusItem = statusList.querySelector(`[data-agent="${agentType}"]`);
          if (!statusItem) {
            statusItem = document.createElement("li");
            statusItem.setAttribute("data-agent", agentType);
            statusList.appendChild(statusItem);
          }

          const statusClasses = {
            pending: "status-pending",
            in_progress: "status-in-progress",
            completed: "status-completed", 
            failed: "status-failed"
          };

          statusItem.innerHTML = `<span class="${statusClasses[status] || ""}">${agentType}: ${status}</span>`;
        }

        startIncidentTimer() {
          if (this.timerInterval) {
            clearInterval(this.timerInterval);
          }

          this.timerInterval = setInterval(() => {
            if (this.incidentStartTime) {
              const elapsed = Math.floor((Date.now() - this.incidentStartTime.getTime()) / 1000);
              const minutes = Math.floor(elapsed / 60);
              const seconds = elapsed % 60;

              const timerElement = document.getElementById("incident-timer");
              if (timerElement) {
                timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, "0")}`;

                // Change color based on time
                if (elapsed > 180) {
                  timerElement.style.color = "#ff6b6b";
                } else if (elapsed > 120) {
                  timerElement.style.color = "#f9ca24";
                } else {
                  timerElement.style.color = "#00ff88";
                }
              }
            }
          }, 1000);
        }

        updateMetricsDisplay() {
          const elements = {
            "incidents-resolved": this.metrics.incidents_resolved.toLocaleString(),
            "cost-savings": `$${(this.metrics.total_cost_savings / 1000000).toFixed(2)}M`,
            "avg-mttr": `${this.metrics.avg_mttr}s`,
            "success-rate": `${(this.metrics.success_rate * 100).toFixed(1)}%`,
            "active-agents": this.metrics.active_agents
          };

          Object.entries(elements).forEach(([id, value]) => {
            const element = document.getElementById(id);
            if (element && element.textContent !== value) {
              // Animate value change
              element.style.transform = "scale(1.1)";
              element.style.color = "#00d4ff";
              setTimeout(() => {
                element.textContent = value;
                element.style.transform = "scale(1)";
                element.style.color = "#00ff88";
              }, 150);
            }
          });
        }

        startMetricsAnimation() {
          setInterval(() => {
            // Subtle metrics updates for demo effect
            if (Math.random() < 0.1) {
              this.metrics.incidents_resolved += 1;
              this.metrics.total_cost_savings += Math.floor(Math.random() * 1000);
              this.updateMetricsDisplay();
            }
          }, 5000);
        }

        celebrateResolution() {
          // Add celebration animation
          const timer = document.getElementById("incident-timer");
          if (timer) {
            timer.style.animation = "none";
            timer.style.color = "#00ff88";
            timer.style.transform = "scale(1.2)";
            timer.style.textShadow = "0 0 30px #00ff88";
            
            setTimeout(() => {
              timer.style.transform = "scale(1)";
              timer.style.textShadow = "0 0 20px rgba(0, 255, 136, 0.5)";
            }, 1000);
          }

          // Show success notification
          this.showNotification("🎉 Incident Resolved Autonomously!", "success");
        }

        setupEventListeners() {
          document.querySelectorAll(".scenario-btn").forEach((btn) => {
            btn.addEventListener("click", async (e) => {
              const scenario = e.currentTarget.dataset.scenario;
              await this.triggerScenario(scenario);
            });
          });
        }

        async triggerScenario(scenarioType) {
          console.log("🎯 Triggering scenario:", scenarioType);

          // Disable buttons with visual feedback
          document.querySelectorAll(".scenario-btn").forEach((btn) => {
            btn.disabled = true;
            btn.style.opacity = "0.6";
          });

          // Show activity spinner
          const spinner = document.getElementById("activity-spinner");
          if (spinner) spinner.style.display = "block";

          try {
            const scenarioMap = {
              "database": "database_cascade",
              "ddos": "ddos_attack",
              "memory": "memory_leak", 
              "api": "api_overload",
              "storage": "storage_failure"
            };

            const apiScenario = scenarioMap[scenarioType] || scenarioType;
            const apiUrl = window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1"
              ? `http://localhost:8000/demo/scenarios/${apiScenario}`
              : `/demo/scenarios/${apiScenario}`;

            const response = await fetch(apiUrl, {
              method: "POST",
              headers: { "Content-Type": "application/json" }
            });

            if (response.ok) {
              const result = await response.json();
              console.log("✅ Scenario triggered:", result);
              this.showNotification(`🚀 ${scenarioType.replace("_", " ")} scenario initiated`, "success");
            } else {
              console.error("❌ Failed to trigger scenario:", response.statusText);
              this.showNotification("❌ Failed to trigger scenario", "error");
            }
          } catch (error) {
            console.error("❌ Error triggering scenario:", error);
            this.showNotification("❌ Connection error", "error");
          } finally {
            // Hide spinner
            const spinner = document.getElementById("activity-spinner");
            if (spinner) spinner.style.display = "none";

            // Re-enable buttons after delay
            setTimeout(() => {
              document.querySelectorAll(".scenario-btn").forEach((btn) => {
                btn.disabled = false;
                btn.style.opacity = "1";
              });
            }, 3000);
          }
        }

        showNotification(message, type = "info") {
          const notification = document.createElement("div");
          const colors = {
            success: { bg: "rgba(0, 255, 136, 0.1)", border: "#00ff88" },
            error: { bg: "rgba(255, 107, 107, 0.1)", border: "#ff6b6b" },
            info: { bg: "rgba(0, 212, 255, 0.1)", border: "#00d4ff" }
          };

          notification.style.cssText = `
            position: fixed;
            top: 120px;
            right: 30px;
            padding: 1.25rem 2rem;
            background: ${colors[type].bg};
            border: 1px solid ${colors[type].border};
            border-radius: 12px;
            color: white;
            font-weight: 600;
            z-index: 2000;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: slideInRight 0.4s cubic-bezier(0.4, 0, 0.2, 1);
          `;
          notification.textContent = message;

          document.body.appendChild(notification);

          setTimeout(() => {
            notification.style.animation = "slideOutRight 0.4s ease";
            setTimeout(() => document.body.removeChild(notification), 400);
          }, 4000);
        }
      }

      // Add CSS animations
      const style = document.createElement("style");
      style.textContent = `
        @keyframes slideInRight {
          from { transform: translateX(100%); opacity: 0; }
          to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOutRight {
          from { transform: translateX(0); opacity: 1; }
          to { transform: translateX(100%); opacity: 0; }
        }
      `;
      document.head.appendChild(style);

      // Initialize enhanced dashboard
      document.addEventListener("DOMContentLoaded", () => {
        console.log("🚀 Initializing Enhanced Live Dashboard");
        new EnhancedLiveDashboard();
      });
    </script>
  </body>
</html>